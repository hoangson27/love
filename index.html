<!DOCTYPE html>
<html lang="vi">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>‚ù§Ô∏è</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }
      body {
        font-family: "Arial", sans-serif;
        height: 100vh;
        width: 100vw;
        background: linear-gradient(
          135deg,
          #1a1a2e 0%,
          #16213e 30%,
          #2d1b69 70%,
          #11998e 100%
        );
        display: flex;
        justify-content: center;
        align-items: center;
        overflow: hidden;
        position: relative;
      }
      .stars {
        position: absolute;
        width: 100%;
        height: 100%;
        top: 0;
        left: 0;
      }
      .star {
        position: absolute;
        width: 2px;
        height: 2px;
        background: white;
        border-radius: 50%;
        animation: twinkle 2s infinite alternate;
      }
      @keyframes twinkle {
        0% {
          opacity: 0.3;
        }
        100% {
          opacity: 1;
        }
      }
      .heart {
        width: 200px;
        height: 200px;
        position: relative;
        margin: 40px 0;
        animation: heartbeat 1.5s ease-in-out infinite;
        z-index: 10;
      }
      .heart::before,
      .heart::after {
        content: "";
        width: 100px;
        height: 160px;
        position: absolute;
        left: 100px;
        top: 0;
        background: transparent;
        border: 4px dashed transparent;
        border-radius: 100px 100px 0 0;
        transform: rotate(-45deg);
        transform-origin: 0 100%;
      }
      .heart::after {
        left: 0;
        transform: rotate(45deg);
        transform-origin: 100% 100%;
      }
      @keyframes heartbeat {
        0%,
        100% {
          transform: scale(1);
        }
        50% {
          transform: scale(1.1);
        }
      }
      .character {
        position: fixed;
        bottom: 50px;
        width: 80px;
        height: 80px;
        background: #ffeaa7;
        border-radius: 50%;
        display: flex;
        justify-content: center;
        align-items: center;
        animation: bounce 2s ease-in-out infinite;
        z-index: 20;
      }
      .character.left {
        left: 80px;
        animation-delay: 0s;
      }
      .character.right {
        right: 80px;
        animation-delay: 1s;
      }
      .character::before {
        content: "üê∞";
        font-size: 40px;
      }
      @keyframes bounce {
        0%,
        100% {
          transform: translateY(0);
        }
        50% {
          transform: translateY(-15px);
        }
      }
      #particleCanvas {
        position: fixed;
        top: 0;
        left: 0;
        width: 100vw;
        height: 100vh;
        pointer-events: none;
        z-index: 5;
      }
      @media (max-width: 768px) {
        .heart {
          width: 150px;
          height: 150px;
        }
        .heart::before,
        .heart::after {
          width: 75px;
          height: 120px;
        }
        .character {
          width: 60px;
          height: 60px;
          bottom: 30px;
        }
        .character.left {
          left: 30px;
        }
        .character.right {
          right: 30px;
        }
        .character::before {
          font-size: 30px;
        }
      }
    </style>
  </head>
  <body>
    <div class="stars" id="stars"></div>
    <canvas id="particleCanvas"></canvas>
    <div class="heart" id="heart"></div>
    <div class="character left" id="leftCharacter"></div>
    <div class="character right" id="rightCharacter"></div>

    <script>
      class ParticleSystem {
        constructor() {
          this.canvas = document.getElementById("particleCanvas");
          this.ctx = this.canvas.getContext("2d");
          this.particles = [];
          this.isActive = false;
          this.hasRun = false;
          this.resizeCanvas();
          window.addEventListener("resize", () => this.resizeCanvas());
          this.setupTargetPoints();
        }

        resizeCanvas() {
          const dpr = window.devicePixelRatio || 1;
          this.canvas.width = window.innerWidth * dpr;
          this.canvas.height = window.innerHeight * dpr;
          this.canvas.style.width = window.innerWidth + "px";
          this.canvas.style.height = window.innerHeight + "px";
          this.ctx.setTransform(1, 0, 0, 1, 0, 0);
          this.ctx.scale(dpr, dpr);
        }

        setupTargetPoints() {
          this.textPoints = this.getTextPoints();
          this.heartPoints = this.getHeartPoints();
        }

        getTextPoints() {
          const points = [];
          const canvas = document.createElement("canvas");
          const ctx = canvas.getContext("2d");
          const dpr = window.devicePixelRatio || 1;

          const width = window.innerWidth * dpr;
          const height = window.innerHeight * dpr;

          canvas.width = width;
          canvas.height = height;

          ctx.scale(dpr, dpr); // Scale ƒë·ªÉ n√©t
          const text = "Nguy·ªÖn B√° Ho√†ng S∆°n";
          const fontSize = Math.min(window.innerWidth / 6, 150); // auto scale
          canvas.width = window.innerWidth;
          canvas.height = window.innerHeight;
          ctx.font = `bold ${fontSize}px Arial`;
          ctx.textAlign = "center";
          ctx.textBaseline = "middle";
          const centerX = canvas.width / 2;
          const centerY = canvas.height / 2 - 100;
          ctx.fillStyle = "white";
          ctx.fillText(text, centerX, centerY);
          const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
          const data = imageData.data;
          const step = 6;
          for (let y = 0; y < canvas.height; y += step) {
            for (let x = 0; x < canvas.width; x += step) {
              const index = (y * canvas.width + x) * 4;
              if (data[index + 3] > 128) {
                points.push({
                  x: x + (Math.random() - 0.5) * 4,
                  y: y + (Math.random() - 0.5) * 4,
                  color: `hsl(${350 + Math.random() * 20},85%,${
                    65 + Math.random() * 15
                  }%)`,
                });
              }
            }
          }
          return points;
        }

        getHeartPoints() {
          const points = [];
          const centerX = window.innerWidth / 2;
          const centerY = window.innerHeight / 2 + 50;
          const size = 130;
          for (let angle = 0; angle < Math.PI * 2; angle += 0.05) {
            const x = size * (16 * Math.pow(Math.sin(angle), 3));
            const y =
              -size *
              (13 * Math.cos(angle) -
                5 * Math.cos(2 * angle) -
                2 * Math.cos(3 * angle) -
                Math.cos(4 * angle));
            points.push({
              x: centerX + x / 16,
              y: centerY + y / 16,
              color: `hsl(${350 + Math.random() * 20},85%,${
                65 + Math.random() * 15
              }%)`,
            });
          }
          return points;
        }

        createParticle(startX, startY, targetPoint) {
          return {
            x: startX,
            y: startY,
            targetX: targetPoint.x,
            targetY: targetPoint.y,
            vx: 0,
            vy: 0,
            color: targetPoint.color,
            life: 1,
            size: Math.random() * 2 + 3,
            reached: false,
          };
        }

        startAnimation() {
          if (this.hasRun) return;
          this.isActive = true;
          this.hasRun = true;
          this.particles = [];
          const leftChar = document.getElementById("leftCharacter");
          const rightChar = document.getElementById("rightCharacter");
          const leftRect = leftChar.getBoundingClientRect();
          const rightRect = rightChar.getBoundingClientRect();
          const leftX = leftRect.left + leftRect.width / 2;
          const leftY = leftRect.top + leftRect.height / 2;
          const rightX = rightRect.left + rightRect.width / 2;
          const rightY = rightRect.top + rightRect.height / 2;

          const leftPoints = this.textPoints.slice(
            0,
            Math.floor(this.textPoints.length / 2)
          );
          const rightTextPoints = this.textPoints.slice(
            Math.floor(this.textPoints.length / 2)
          );
          const leftHeartPoints = this.heartPoints.slice(
            0,
            Math.floor(this.heartPoints.length / 2)
          );
          const rightHeartPoints = this.heartPoints.slice(
            Math.floor(this.heartPoints.length / 2)
          );
          const maxLength = Math.max(
            leftPoints.length + leftHeartPoints.length,
            rightTextPoints.length + rightHeartPoints.length
          );

          for (let i = 0; i < maxLength; i++) {
            setTimeout(() => {
              if (!this.isActive) return;
              if (i < leftPoints.length)
                this.particles.push(
                  this.createParticle(leftX, leftY, leftPoints[i])
                );
              else if (i - leftPoints.length < leftHeartPoints.length)
                this.particles.push(
                  this.createParticle(
                    leftX,
                    leftY,
                    leftHeartPoints[i - leftPoints.length]
                  )
                );
            }, i * 25);

            setTimeout(() => {
              if (!this.isActive) return;
              if (i < rightTextPoints.length)
                this.particles.push(
                  this.createParticle(rightX, rightY, rightTextPoints[i])
                );
              else if (i - rightTextPoints.length < rightHeartPoints.length)
                this.particles.push(
                  this.createParticle(
                    rightX,
                    rightY,
                    rightHeartPoints[i - rightTextPoints.length]
                  )
                );
            }, i * 25 + 12);
          }

          this.animate();
        }

        animate() {
          if (!this.isActive) return;
          this.ctx.clearRect(0, 0, this.canvas.width, this.canvas.height);
          this.particles.forEach((p) => {
            if (!p.reached) {
              const dx = p.targetX - p.x;
              const dy = p.targetY - p.y;
              const dist = Math.sqrt(dx * dx + dy * dy);
              if (dist < 3) p.reached = true;
              else {
                p.vx += dx * 0.03;
                p.vy += dy * 0.03;
                p.vx *= 0.98;
                p.vy *= 0.98;
                p.x += p.vx;
                p.y += p.vy;
              }
            }
            this.ctx.beginPath();
            this.ctx.arc(p.x, p.y, p.size, 0, Math.PI * 2);
            this.ctx.fillStyle = p.color;
            this.ctx.shadowBlur = 15;
            this.ctx.shadowColor = p.color;
            this.ctx.fill();
            this.ctx.shadowBlur = 0;
          });
          requestAnimationFrame(() => this.animate());
        }
      }

      const particleSystem = new ParticleSystem();

      // Stars
      function createStars() {
        const starsContainer = document.getElementById("stars");
        const numberOfStars = 100;
        for (let i = 0; i < numberOfStars; i++) {
          const star = document.createElement("div");
          star.className = "star";
          star.style.left = Math.random() * 100 + "%";
          star.style.top = Math.random() * 100 + "%";
          star.style.animationDelay = Math.random() * 2 + "s";
          starsContainer.appendChild(star);
        }
      }
      createStars();

      // Start animation once
      setTimeout(() => {
        particleSystem.startAnimation();
      }, 2000);
    </script>
  </body>
</html>